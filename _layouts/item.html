---
layout: page
---

{%- assign format = site.data[page.manifest_name].manifest.items[0].items[0].items[0].body.type -%}
{{ content }}


{% if site.data[page.manifest_name].manifest.items[0].items[0].items[0].body.id == "" %}
  The media file is not available

{% else %}
  <div id="uv" {%- if format == "Audio" or format == "Sound" -%} class="uv uv-audio sticky" {%- else -%} class="uv uv-video sticky" {%- endif -%}  ></div>
{% endif %}
<!--  <script
    type="application/javascript"
    src="https://universalviewer-git-fork-brumfieldlabs-load-a-a3d751-mnemoscene.vercel.app/umd/UV.js"
  ></script> -->

  <script
    type="application/javascript"
    src="https://unpkg.com/universalviewer@4.0.0-pre.64/dist/umd/UV.js"
  ></script>


  <script src="{{ site.baseurl }}/assets/datatables/datatables.min.js"></script>
  <script>
    var myUV;

    myUV = UV.init('uv', {
        manifestUri: '{{site.data[page.manifest_name].manifest.id}}',
        manifest: '{{site.data[page.manifest_name].manifest.id}}',
        root: '../../{{ site.baseurl }}/assets/uv/umd'
    });



      // override config using an inline json object
      myUV.on("configure", function ({ config, cb }) {
        cb({
            "options": {
              "dropEnabled": true,
              "footerPanelEnabled": false,
              "headerPanelEnabled": false,
              "leftPanelEnabled": false,
              "limitLocales": false,
              "overrideFullScreen": false,
              "pagingEnabled": false,
              "rightPanelEnabled": false
             }
        });
      });
</script>

<table id="annotation-table"  class="table table-bordered table-dark">
  <thead>
    <tr>
      <th style="width: 20%;">Time</th>
      <th>Annotation</th>
      <th>Layer</th>
    </tr>
  </thead>
  <tbody>
    {%- for annotation_page in site.data[page.manifest_name].manifest.items[0].annotations -%}
      {%- if annotation_page.label.first -%}
        {% assign page_label = annotation_page.label.first[1] %}
      {% else %}
        {% assign page_label = annotation_page.label %}
      {% endif %}

      {%- if annotation_page.id contains site.github_username -%}
        {% assign portions = annotation_page.id | split: '/' %}
        {% assign real_slug = portions[7] | replace: ".json", "" %}
      {%- else -%}
        {% assign real_slug = annotation_page.id | replace: ":", "_"| replace: ".", "_" | replace: ",", "_"| replace: "/", "_" %}
      {%- endif -%}

      {%- for annotation in site.data[page.manifest_name].canvas-1[real_slug].items -%}
        <tr>
          {% if annotation.target.selector %}
            {% assign timestamp_array = annotation.target.selector.t | split: ',' %}
          {% else %}
            {% assign target_array = annotation.target | split: 't=' %}
            {% assign timestamp_array = target_array[1] | split: ',' %}
          {% endif %}
          <td class="timestamp" 
              data-timestamp="{{timestamp_array[0]}}"  
              data-sort="{{timestamp_array[0]}}" 
              data-target="{{annotation.target.source}}"
              {% if timestamp_array[1] %}
                data-endtime="{{timestamp_array[1]}}"  
              {% endif %}
          >
           {% assign seconds = timestamp_array[0] | times: 1 %}
            {% if seconds >= 3600 %}
              {{ seconds | divided_by: 3600 | floor }}:{{seconds | divided_by: 60 | modulo: 60 | floor | prepend: '00' | slice: -2, 2 }}:{{seconds | modulo: 60 | ceil | prepend: '00' | slice: -2, 2}} 
            {% else %}
              {{seconds | divided_by: 60 | modulo: 60 | floor }}:{{seconds | modulo: 60 | ceil | prepend: '00' | slice: -2, 2}} 
            {% endif %}
            {% if timestamp_array[1] %}
              {% assign endseconds = timestamp_array[1] | times: 1 %}
              - 
                {% if endseconds >= 3600 %}
                  {{ endseconds | divided_by: 3600 | floor }}:{{endseconds | divided_by: 60 | modulo: 60 | floor | prepend: '00' | slice: -2, 2 }}:{{endseconds | modulo: 60 | ceil | prepend: '00' | slice: -2, 2}} 
                {% else %}
                  {{endseconds | divided_by: 60 | modulo: 60 | floor }}:{{endseconds | modulo: 60 | ceil | prepend: '00' | slice: -2, 2}} 
                {% endif %}
            {% endif %}
          </td>
          <td>
            {%- if annotation.body['type'] -%}
              {% assign body = annotation.body.value %}
            {% else %}
              {% assign body = "" %}
              {%- for raw_body in annotation.body -%}
                {% assign body = body | append: raw_body.value | append: "<br/>" %}
              {% endfor %}
            {% endif %}

            {{body | newline_to_br}}
          </td>
          <td>{{page_label}}</td>
        </tr>
      {%- endfor -%}
    {%- endfor -%}
  </tbody>
</table>

<div>
<p></p>
<p>
  <a href="{{ site.data[page.manifest_name].manifest.homepage[0].id }}">{{ site.data[page.manifest_name].manifest.homepage[0].label.en[0] }}</a>
   at 
  <a href="{{ site.data[page.manifest_name].manifest.provider[0].id }}">{{ site.data[page.manifest_name].manifest.provider[0].label.en[0] }}</a>. 
</p>
IIIF manifest: <a href="{{site.data[page.manifest_name].manifest.id}}">{{site.data[page.manifest_name].manifest.id}}</a>
</div>


<script>
  $('tr').on('click',function(){
     var mySelectorTimestamp = $(this).find('td.timestamp').data('timestamp');
     var mySelectorEndTime = $(this).find('td.timestamp').data('endtime');
     var myTarget = $(this).find('td.timestamp').data('target');
     if (myTarget) {
       target = myTarget + '#t=' + mySelectorTimestamp;
       //if (mySelectorEndTime) {
       //  target = myTarget + '#t=' + mySelectorTimestamp + ',' + mySelectorEndTime;
       //}
       console.log(target);
       myUV.set({
         target: target,
       });       
       //myUV.extension.centerPanel.avcomponent.canvasInstances[0]._setCurrentTime(myDataAttr);
       //myUV.extension.centerPanel.avcomponent.play();
     }
   });

$(document).ready( function() {
    $('#annotation-table').DataTable(
  { paging: false }
);
} );
 </script>


